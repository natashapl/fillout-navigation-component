"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var i=Array(e),r=0,t=0;t<n;t++)for(var a=arguments[t],o=0,c=a.length;o<c;o++,r++)i[r]=a[o];return i};exports.__esModule=!0;var react_1=require("react"),uuid_1=require("uuid"),image_1=require("next/image"),core_1=require("@dnd-kit/core"),sortable_1=require("@dnd-kit/sortable"),SortablePageButton_1=require("./SortablePageButton"),ContextMenu_1=require("./ContextMenu"),initialPages=[{id:"1",title:"Info",iconActive:"/icons/icon-info-orange.svg",iconInactive:"/icons/icon-info-gray.svg"},{id:"2",title:"Details",iconActive:"/icons/icon-page-orange.svg",iconInactive:"/icons/icon-page-gray.svg"},{id:"3",title:"Other",iconActive:"/icons/icon-page-orange.svg",iconInactive:"/icons/icon-page-gray.svg"},{id:"4",title:"Ending",iconActive:"/icons/icon-ending-orange.svg",iconInactive:"/icons/icon-ending-gray.svg"}];function Navigation(){var e=react_1.useState(initialPages),s=e[0],l=e[1],t=react_1.useState(s[0].id),i=t[0],r=t[1],n=react_1.useState({isOpen:!1,pageId:null}),a=n[0],o=n[1],c=core_1.useSensors(core_1.useSensor(core_1.PointerSensor,{activationConstraint:{distance:8}}),core_1.useSensor(core_1.KeyboardSensor,{coordinateGetter:sortable_1.sortableKeyboardCoordinates})),u=react_1.useState(!1),d=u[0],g=u[1];if(react_1.useEffect(function(){g(!0)},[]),!d)return null;function f(e,t){t.preventDefault(),t.stopPropagation(),o({isOpen:!0,pageId:e})}function p(){o({isOpen:!1,pageId:null})}function v(){var e,t,n;!a.pageId||-1!==(e=s.findIndex(function(e){return e.id===a.pageId}))&&0!==e&&(t=s[e],n=__spreadArrays([t],s.filter(function(e){return e.id!==a.pageId})),l(n),r(t.id))}function b(){var e,t;a.pageId&&(!(e=s.find(function(e){return e.id===a.pageId}))||(t=prompt("Enter new page name:",e.title))&&t.trim()&&l(s.map(function(e){return e.id===a.pageId?__assign(__assign({},e),{title:t.trim()}):e})))}function _(){var e;!a.pageId||(e=s.find(function(e){return e.id===a.pageId}))&&navigator.clipboard.writeText(e.title).then(function(){alert("Copied: "+e.title)})}function m(){var e,t,n,i;!a.pageId||-1!==(e=s.findIndex(function(e){return e.id===a.pageId}))&&(t=s[e],n=__assign(__assign({},t),{id:uuid_1.v4(),title:t.title+" (Copy)"}),i=__spreadArrays(s.slice(0,e+1),[n],s.slice(e+1)),l(i))}function h(){var e,t;!a.pageId||(e=s.find(function(e){return e.id===a.pageId}))&&(s.length<=2||"Ending"===e.title?alert("Cannot delete this page"):confirm('Are you sure you want to delete "'+e.title+'"?')&&(t=s.filter(function(e){return e.id!==a.pageId}),l(t),i===a.pageId&&r(t[0].id)))}function y(t){var e,n,i,r=s.findIndex(function(e){return e.id===t});-1!==r&&(e=r===s.length-1&&"Ending"===s[r].title?r:r+1,n={id:uuid_1.v4(),title:"New Page "+x,iconActive:"/icons/icon-page-orange.svg",iconInactive:"/icons/icon-page-gray.svg"},i=__spreadArrays(s.slice(0,e),[n],s.slice(e)),console.log("New pages:",i),l(i))}var I=s.filter(function(e){return"Ending"!==e.title}),x=s.filter(function(e){return e.title.startsWith("New Page")}).length+1;return React.createElement("div",{className:"flex flex-wrap items-center gap-y-4 p-6 border rounded-md bg-white shadow-sm"},React.createElement(core_1.DndContext,{sensors:c,collisionDetection:core_1.closestCenter,onDragEnd:function(e){var t,n,i,r,a,o=e.active,c=e.over;c&&o.id!==c.id&&(i=s.findIndex(function(e){return e.id===o.id}),r=s.findIndex(function(e){return e.id===c.id}),"Ending"!==(null===(t=s[i])||void 0===t?void 0:t.title)&&"Ending"!==(null===(n=s[r])||void 0===n?void 0:n.title)&&(a=sortable_1.arrayMove(s,i,r),l(a)))}},React.createElement(sortable_1.SortableContext,{items:I.map(function(e){return e.id}),strategy:sortable_1.verticalListSortingStrategy},s.map(function(e,t){return"Ending"===e.title?(n=e,React.createElement("div",{key:n.id,className:"relative group flex items-center"},React.createElement("div",{className:"flex items-center rounded-lg border text-foreground text-[14px]/[20px] tracking-[-1.5%] whitespace-nowrap cursor-grab active:cursor-grabbing focus:border focus:border-default-blue focus-visible:outline-2 focus-visible:outline-default-blue/25\n          "+(n.id===i?"bg-white border-active-orange":"bg-default-light-gray-bg border-default-light-gray-bg hover:bg-default-medium-gray-bg pr-2.5")+"\n        ",onClick:function(){return r(n.id)},tabIndex:0,onKeyDown:function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n.id===i?a.isOpen&&a.pageId===n.id?p():f(n.id,{preventDefault:function(){},stopPropagation:function(){},clientX:0,clientY:0}):r(n.id))}},React.createElement("div",{className:"flex items-center px-2.5 py-1 cursor-grab active:cursor-grabbing focus:border focus:border-default-blue focus-visible:outline-2 focus-visible:outline-default-blue/25 rounded",role:"button"},React.createElement(image_1.default,{className:"mr-1.5",src:n.id===i?n.iconActive:n.iconInactive,alt:n.title+" icon",width:20,height:20}),n.title),n.id===i&&React.createElement("div",{onClick:function(e){e.stopPropagation(),a.isOpen&&a.pageId===n.id?p():f(n.id,e)},className:"pr-2.5 py-1.5 rounded-tr-lg rounded-br-lg transition-colors cursor-pointer focus:border focus:border-default-blue focus-visible:outline-2 focus-visible:outline-default-blue/25  "+(a.isOpen&&a.pageId===n.id?"bg-default-light-gray-bg":"hover:bg-default-light-gray-bg"),role:"button","data-menu-trigger":"true",onKeyDown:function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),a.isOpen&&a.pageId===n.id?p():f(n.id,{preventDefault:function(){},stopPropagation:function(){},clientX:0,clientY:0}))}},React.createElement(image_1.default,{src:"/icons/icon-menu.svg",alt:"Menu",width:16,height:16,style:{height:"auto"}}))),a.isOpen&&a.pageId===n.id&&React.createElement("div",{className:"absolute top-full left-0 z-50 mt-1"},React.createElement(ContextMenu_1.default,{isOpen:!0,onClose:p,onSetAsFirst:v,onRename:b,onCopy:_,onDuplicate:m,onDelete:h})))):React.createElement(SortablePageButton_1.default,{key:e.id,page:e,isActive:e.id===i,setActivePageId:r,addPageAfter:y,isLast:t===s.length-1,onContextMenu:f,showContextMenu:a.isOpen&&a.pageId===e.id,onCloseContextMenu:p,onSetAsFirst:v,onRename:b,onCopy:_,onDuplicate:m,onDelete:h});var n}))),React.createElement(image_1.default,{src:"/icons/icon-divider.svg",alt:"",width:20,height:1.5,style:{height:"auto"}}),React.createElement("button",{onClick:function(){var e,t={id:uuid_1.v4(),title:"New Page "+x,iconActive:"/icons/icon-page-orange.svg",iconInactive:"/icons/icon-page-gray.svg"},n=s.findIndex(function(e){return"Ending"===e.title});-1!==n?(e=__spreadArrays(s.slice(0,n),[t],s.slice(n)),l(e)):l(function(e){return __spreadArrays(e,[t])})},className:"flex items-center gap-1.5 px-2.5 py-1 rounded-lg border text-foreground text-[14px]/[20px] tracking-[-1.5%] cursor-pointer whitespace-nowrap border-light-gray hover:bg-default-medium-gray-bg focus:border focus:border-default-blue focus-visible:outline-2 focus-visible:outline-default-blue/25"},React.createElement(image_1.default,{src:"/icons/icon-plus.svg",alt:"",width:16,height:16,style:{height:"auto"}}),React.createElement("span",null,"Add page")))}exports.default=Navigation;